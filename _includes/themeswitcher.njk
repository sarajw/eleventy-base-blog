<div id="theme-switching">
  <div class="css-switching">
    <select name="css-in-use" id="css-switcher">
      <option value="classic">Classic (WIP)</option>
      <option value="original">Original</option>
      <option value="simple-purple">Simple Purple (WIP)</option>
    </select>
    <a id="css-download-link" href="/css/original/index.css" download="">Download CSS</a>
  </div>
  <div id="mode-switcher" style="display: none">
    <p class="visually-hidden" id="light-and-dark-mode-switchers">Light and dark mode switchers</p>
    <button id="lightSwitch" aria-pressed="false" type="button" onclick="switchLight()">Light</button>
    <button id="darkSwitch" aria-pressed="false" type="button" onclick="switchDark()">Dark</button>
    <button id="autoSwitch" aria-pressed="true" type="button" onclick="switchAuto()">Auto</button>
  </div>
</div>

<script>
  const html = document.querySelector('html');
  const lightSwitch = document.querySelector('#lightSwitch');
  const darkSwitch = document.querySelector('#darkSwitch');
  const autoSwitch = document.querySelector('#autoSwitch');
  const cssSwitch = document.querySelector("#css-switcher");
  const cssLink = document.querySelector("#css-download-link");
  const currentStyleSheet = document.querySelector("#current-style-sheet");
  const mode = sessionStorage.getItem("mode");
  const css = sessionStorage.getItem("css");

  function switchCSS(cssName) {
    currentStyleSheet.setAttribute("href", `/css/${cssName}/index.css`);
    cssLink.setAttribute("href", `/css/${cssName}/index.css`);
    sessionStorage.setItem("css", cssName);
  }

  cssSwitch.addEventListener("change", (event) => {
    switchCSS(event.target.value);
  })

  function switchDark() {
    html.style.colorScheme = "dark";
    sessionStorage.setItem("mode", "dark");
    lightSwitch.setAttribute("aria-pressed","false");
    darkSwitch.setAttribute("aria-pressed","true");
    autoSwitch.setAttribute("aria-pressed","false");
  }
  function switchLight() {
    html.style.colorScheme = "light";
    sessionStorage.setItem("mode", "light");
    lightSwitch.setAttribute("aria-pressed","true");
    darkSwitch.setAttribute("aria-pressed","false");
    autoSwitch.setAttribute("aria-pressed","false");
  }
  function switchAuto() {
    html.style.colorScheme = "light dark";
    sessionStorage.removeItem("mode");
    lightSwitch.setAttribute("aria-pressed","false");
    darkSwitch.setAttribute("aria-pressed","false");
    autoSwitch.setAttribute("aria-pressed","true");
  }

  //check for session preferences
  if (mode) {
    if (mode === "dark") {switchDark();}
    else if (mode === "light") {switchLight();}
  }
  if (css && css !== cssName) {
    switchCSS(css);
    cssSwitch.value = css;
  }
</script>